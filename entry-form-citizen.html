<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‚™å‰ä¸¸ å¸‚æ°‘é™å®šå†…è¦§ä¼š ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ•ã‚©ãƒ¼ãƒ </title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 700px; margin: 0 auto; background: white; border-radius: 16px; padding: 32px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); }
        .header { text-align: center; margin-bottom: 32px; padding-bottom: 24px; border-bottom: 3px solid #c41e3a; }
        .header h1 { color: #c41e3a; font-size: 26px; margin-bottom: 8px; }
        .header .badge { display: inline-block; background: #27ae60; color: white; padding: 6px 16px; border-radius: 20px; font-size: 14px; font-weight: 600; margin-bottom: 12px; }
        .header p { color: #666; font-size: 14px; }
        .form-section { margin-bottom: 32px; }
        .section-title { font-size: 18px; font-weight: 700; color: #333; margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid #f0f0f0; }
        .date-selection { display: flex; flex-direction: column; gap: 12px; margin-bottom: 24px; }
        .date-card { border: 3px solid #e0e0e0; border-radius: 12px; padding: 16px; cursor: pointer; transition: all 0.3s; position: relative; }
        .date-card:hover { border-color: #667eea; background: #f5f8ff; }
        .date-card.selected { border-color: #667eea; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .date-card input[type="radio"] { position: absolute; opacity: 0; }
        .date-info { display: flex; justify-content: space-between; align-items: center; }
        .date-text { font-size: 18px; font-weight: 700; }
        .date-badge { background: rgba(255, 255, 255, 0.2); padding: 4px 12px; border-radius: 12px; font-size: 13px; font-weight: 600; }
        .date-card.selected .date-badge { background: rgba(255, 255, 255, 0.3); }
        .timeslot-section { display: none; margin-top: 20px; }
        .timeslot-section.active { display: block; }
        .timeslot-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; }
        .timeslot-card { border: 2px solid #e0e0e0; border-radius: 10px; padding: 14px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .timeslot-card:hover { border-color: #27ae60; background: #e8f5e9; }
        .timeslot-card.selected { border-color: #27ae60; background: #27ae60; color: white; }
        .timeslot-card input[type="radio"] { display: none; }
        .timeslot-time { font-size: 16px; font-weight: 700; margin-bottom: 4px; }
        .timeslot-count { font-size: 12px; opacity: 0.8; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: #333; font-weight: 600; font-size: 14px; }
        .required { color: #c41e3a; margin-left: 4px; }
        .form-group input[type="text"], .form-group input[type="email"], .form-group input[type="tel"], .form-group select { width: 100%; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; transition: all 0.3s; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        .postal-group { display: flex; gap: 8px; align-items: flex-end; }
        .postal-input { flex: 1; }
        .search-btn { padding: 12px 20px; background: #27ae60; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; white-space: nowrap; transition: all 0.3s; }
        .search-btn:hover { background: #229954; }
        .submit-btn { width: 100%; padding: 16px; background: linear-gradient(135deg, #c41e3a 0%, #a3162e 100%); color: white; border: none; border-radius: 12px; font-size: 18px; font-weight: 700; cursor: pointer; transition: all 0.3s; margin-top: 24px; }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(196, 30, 58, 0.3); }
        .submit-btn:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        .loading-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.8); z-index: 9999; justify-content: center; align-items: center; }
        .loading-overlay.active { display: flex; }
        .loading-content { text-align: center; color: white; }
        .spinner { width: 60px; height: 60px; border: 5px solid rgba(255, 255, 255, 0.3); border-top-color: white; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { font-size: 18px; font-weight: 600; margin-bottom: 8px; }
        .loading-subtext { font-size: 14px; opacity: 0.8; }
        @media (max-width: 600px) { .container { padding: 24px 16px; } .header h1 { font-size: 22px; } .timeslot-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="badge">ğŸ›ï¸ å¸‚æ°‘é™å®š</div>
            <h1>ğŸš¢ å‚™å‰ä¸¸ å†…è¦§ä¼šã‚¨ãƒ³ãƒˆãƒªãƒ¼</h1>
            <p>ä»¥ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒ ã«å¿…è¦äº‹é …ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
        </div>
        <form id="entryForm">
            <div class="form-section">
                <div class="section-title">ğŸ“… ã”å¸Œæœ›ã®æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
                <div class="date-selection">
                    <label class="date-card"><input type="radio" name="date" value="2026-02-27" required><div class="date-info"><span class="date-text">2æœˆ27æ—¥ï¼ˆé‡‘ï¼‰</span><span class="date-badge" id="badge-2026-02-27">0ä»¶äºˆç´„</span></div><div style="font-size: 13px; color: #666; margin-top: 8px;">09:00ã€œ15:00</div></label>
                    <label class="date-card"><input type="radio" name="date" value="2026-03-27" required><div class="date-info"><span class="date-text">3æœˆ27æ—¥ï¼ˆé‡‘ï¼‰</span><span class="date-badge" id="badge-2026-03-27">0ä»¶äºˆç´„</span></div><div style="font-size: 13px; color: #666; margin-top: 8px;">09:00ã€œ15:00</div></label>
                    <label class="date-card"><input type="radio" name="date" value="2026-03-28" required><div class="date-info"><span class="date-text">3æœˆ28æ—¥ï¼ˆåœŸï¼‰</span><span class="date-badge" id="badge-2026-03-28">0ä»¶äºˆç´„</span></div><div style="font-size: 13px; color: #666; margin-top: 8px;">09:00ã€œ15:00</div></label>
                </div>
                <div class="timeslot-section" id="timeslotSection">
                    <div class="section-title">â° ã”å¸Œæœ›ã®æ™‚é–“å¸¯ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
                    <div class="timeslot-grid" id="timeslotGrid"></div>
                </div>
            </div>
            <div class="form-section">
                <div class="section-title">ğŸ“ ãŠå®¢æ§˜æƒ…å ±</div>
                <div class="form-group"><label>æ°å <span class="required">â€»</span></label><input type="text" name="name" required placeholder="å±±ç”° å¤ªéƒ"></div>
                <div class="form-group"><label>éƒµä¾¿ç•ªå· <span class="required">â€»</span></label><div class="postal-group"><input type="text" name="postal" id="postal" class="postal-input" required placeholder="701-3204ï¼ˆãƒã‚¤ãƒ•ãƒ³ãªã—ã€å…¨è§’å¯ï¼‰" maxlength="8"><button type="button" class="search-btn" id="searchPostalBtn">ğŸ” æ¤œç´¢</button></div><div style="font-size: 12px; color: #999; margin-top: 4px;">â€» å…¨è§’æ•°å­—ã§ã‚‚è‡ªå‹•ã§åŠè§’ã«å¤‰æ›ã•ã‚Œã¾ã™</div></div>
                <div class="form-group"><label>ä½æ‰€ <span class="required">â€»</span></label><input type="text" name="address" id="address" required placeholder="å²¡å±±çœŒå‚™å‰å¸‚æ—¥ç”Ÿç”ºæ—¥ç”Ÿ"></div>
                <div class="form-group"><label>é›»è©±ç•ªå· <span class="required">â€»</span></label><input type="tel" name="phone" required placeholder="090-1234-5678"></div>
                <div class="form-group"><label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ <span class="required">â€»</span></label><input type="email" name="email" id="email" required placeholder="example@example.com"><div style="font-size: 12px; color: #999; margin-top: 4px;">â€» äºˆç´„ç¢ºèªãƒ¡ãƒ¼ãƒ«ãŒé€ä¿¡ã•ã‚Œã¾ã™</div></div>
                <div class="form-group"><label>å¹´é½¢ <span class="required">â€»</span></label><select name="age" required><option value="">é¸æŠã—ã¦ãã ã•ã„</option><option value="10ä»£ä»¥ä¸‹">10ä»£ä»¥ä¸‹</option><option value="20ä»£">20ä»£</option><option value="30ä»£">30ä»£</option><option value="40ä»£">40ä»£</option><option value="50ä»£">50ä»£</option><option value="60ä»£">60ä»£</option><option value="70ä»£ä»¥ä¸Š">70ä»£ä»¥ä¸Š</option></select></div>
                <div class="form-group"><label>æ€§åˆ¥ <span class="required">â€»</span></label><select name="gender" required><option value="">é¸æŠã—ã¦ãã ã•ã„</option><option value="ç”·æ€§">ç”·æ€§</option><option value="å¥³æ€§">å¥³æ€§</option><option value="ãã®ä»–">ãã®ä»–</option></select></div>
            </div>
            <button type="submit" class="submit-btn">äºˆç´„ã‚’ç¢ºå®šã™ã‚‹</button>
        </form>
    </div>
    <div class="loading-overlay" id="loadingOverlay"><div class="loading-content"><div class="spinner"></div><div class="loading-text">äºˆç´„å‡¦ç†ä¸­...</div><div class="loading-subtext" id="loadingSubtext">ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„</div></div></div>
    <script>
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbzQ4V4f8FF5q1nTVqYVMuopiGHWmMglhVzxJo-gVD-a41N7HGMbhasyAh6BFdNMgsBF/exec';
        const TIMESLOTS = [{start:'09:00',end:'10:00'},{start:'10:00',end:'11:00'},{start:'11:00',end:'12:00'},{start:'13:00',end:'14:00'},{start:'14:00',end:'15:00'}];
        let selectedDate=null,selectedTimeslot=null;
        function init(){console.log('ğŸš€ åˆæœŸåŒ–é–‹å§‹');setupEventListeners();updateReservationCounts();console.log('âœ… åˆæœŸåŒ–å®Œäº†');}
        function setupEventListeners(){console.log('ğŸ“¡ ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šé–‹å§‹');document.querySelectorAll('input[name="date"]').forEach(r=>r.addEventListener('change',handleDateChange));const postalInput=document.getElementById('postal');if(postalInput){let isFormatting=false,lastSearchedValue='';postalInput.addEventListener('input',function(e){if(e.isComposing||isFormatting)return;isFormatting=true;let value=e.target.value.replace(/[ï¼-ï¼™]/g,s=>String.fromCharCode(s.charCodeAt(0)-0xFEE0));const cleanValue=value.replace(/[^0-9]/g,'');const truncated=cleanValue.slice(0,7);const formatted=truncated.length>3?truncated.slice(0,3)+'-'+truncated.slice(3):truncated;e.target.value=formatted;if(truncated.length===7&&truncated!==lastSearchedValue){lastSearchedValue=truncated;console.log('âœ… 7æ¡å…¥åŠ›å®Œäº† â†’ è‡ªå‹•æ¤œç´¢é–‹å§‹');setTimeout(searchPostal,300);}isFormatting=false;});postalInput.addEventListener('keypress',function(e){if(e.key==='Enter'){e.preventDefault();searchPostal();}});}const searchBtn=document.getElementById('searchPostalBtn');if(searchBtn)searchBtn.addEventListener('click',searchPostal);const emailInput=document.getElementById('email');if(emailInput)emailInput.addEventListener('blur',checkEmailDomain);const form=document.getElementById('entryForm');if(form)form.addEventListener('submit',handleSubmit);console.log('âœ… ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šå®Œäº†');}
        function handleDateChange(e){console.log('ğŸ“… æ—¥ä»˜é¸æŠ:',e.target.value);selectedDate=e.target.value;console.log('âœ… selectedDateæ›´æ–°:',selectedDate);document.querySelectorAll('.date-card').forEach(card=>card.classList.remove('selected'));e.target.closest('.date-card').classList.add('selected');const timeslotSection=document.getElementById('timeslotSection');if(timeslotSection){timeslotSection.classList.add('active');console.log('âœ… timeslotSection ã« active ã‚¯ãƒ©ã‚¹è¿½åŠ ');}else{console.error('âŒ timeslotSection ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');}generateTimeslots();}
        function generateTimeslots(){console.log('â° æ™‚é–“å¸¯ç”Ÿæˆé–‹å§‹, selectedDate:',selectedDate);const grid=document.getElementById('timeslotGrid');if(!grid){console.error('âŒ timeslotGrid ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');return;}grid.innerHTML='';console.log('âœ… timeslotGrid ã‚’ã‚¯ãƒªã‚¢');const entries=JSON.parse(localStorage.getItem('citizenEntries')||'[]');const dateEntries=entries.filter(e=>e.date===selectedDate);console.log('ğŸ“Š ã“ã®æ—¥ã®äºˆç´„æ•°:',dateEntries.length);TIMESLOTS.forEach(slot=>{const count=dateEntries.filter(e=>e.timeslot===slot.start).length;const card=document.createElement('label');card.className='timeslot-card';card.innerHTML='<input type="radio" name="timeslot" value="'+slot.start+'" required><div class="timeslot-time">'+slot.start+'ã€œ'+slot.end+'</div><div class="timeslot-count">'+count+'ä»¶äºˆç´„</div>';card.querySelector('input').addEventListener('change',function(ev){selectedTimeslot=ev.target.value;console.log('âœ… æ™‚é–“å¸¯é¸æŠ:',selectedTimeslot);document.querySelectorAll('.timeslot-card').forEach(c=>c.classList.remove('selected'));card.classList.add('selected');});grid.appendChild(card);console.log('âœ… æ™‚é–“å¸¯ã‚«ãƒ¼ãƒ‰è¿½åŠ :',slot.start+'ã€œ'+slot.end);});console.log('âœ… æ™‚é–“å¸¯ç”Ÿæˆå®Œäº†');}
        function updateReservationCounts(){const entries=JSON.parse(localStorage.getItem('citizenEntries')||'[]');['2026-02-27','2026-03-27','2026-03-28'].forEach(date=>{const count=entries.filter(e=>e.date===date).length;const badge=document.getElementById('badge-'+date);if(badge)badge.textContent=count+'ä»¶äºˆç´„';});}
        async function searchPostal(){console.log('ğŸ”¥ searchPostal() é–‹å§‹');const postalInput=document.getElementById('postal');const addressInput=document.getElementById('address');if(!postalInput||!addressInput){console.error('âŒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');return;}const postal=postalInput.value.replace(/[^0-9]/g,'');console.log('ğŸ“® éƒµä¾¿ç•ªå·:',postal);if(postal.length!==7){console.log('âš ï¸ 7æ¡ã§ã¯ã‚ã‚Šã¾ã›ã‚“');return;}addressInput.value='æ¤œç´¢ä¸­...';addressInput.disabled=true;try{const url='https://zipcloud.ibsnet.co.jp/api/search?zipcode='+postal;console.log('ğŸŒ APIå‘¼ã³å‡ºã—:',url);const response=await fetch(url);const data=await response.json();console.log('ğŸ“¦ APIå¿œç­”:',data);if(data.status===200&&data.results&&data.results.length>0){const result=data.results[0];const address=result.address1+result.address2+result.address3;addressInput.value=address;addressInput.disabled=false;console.log('âœ… ä½æ‰€å–å¾—æˆåŠŸ:',address);}else{addressInput.value='';addressInput.disabled=false;addressInput.placeholder='è©²å½“ã™ã‚‹ä½æ‰€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ';console.log('âŒ è©²å½“ã™ã‚‹ä½æ‰€ãªã—');}}catch(error){console.error('âŒ éƒµä¾¿ç•ªå·æ¤œç´¢ã‚¨ãƒ©ãƒ¼:',error);addressInput.value='';addressInput.disabled=false;addressInput.placeholder='æ¤œç´¢ã«å¤±æ•—ã—ã¾ã—ãŸ';}}
        function checkEmailDomain(){const emailInput=document.getElementById('email');const email=emailInput.value.trim();const typos={'gmial.com':'gmail.com','gmai.com':'gmail.com','yahooo.co.jp':'yahoo.co.jp','yaho.co.jp':'yahoo.co.jp'};for(let typo in typos){if(email.endsWith('@'+typo)){const correct=email.replace(typo,typos[typo]);if(confirm('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ã€Œ'+correct+'ã€ã«ä¿®æ­£ã—ã¾ã™ã‹ï¼Ÿ')){emailInput.value=correct;}break;}}}
        async function handleSubmit(e){e.preventDefault();if(!selectedDate||!selectedTimeslot){alert('âš ï¸ æ—¥ä»˜ã¨æ™‚é–“å¸¯ã‚’é¸æŠã—ã¦ãã ã•ã„');return;}console.log('ğŸ“ ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡é–‹å§‹');const loadingOverlay=document.getElementById('loadingOverlay');loadingOverlay.classList.add('active');try{// ç´›ã‚‰ã‚ã—ã„æ–‡å­—ã‚’é™¤å¤–ã—ãŸIDç”Ÿæˆ
const chars = '23456789ABCDEFGHJKLMNPQRSTUVWXYZ'; // 0,O,1,I ã‚’é™¤å¤–
let randomStr = '';
for (let i = 0; i < 8; i++) {
    randomStr += chars.charAt(Math.floor(Math.random() * chars.length));
}
const ticketId = 'CM' + Date.now() + randomStr;console.log('ğŸ« ãƒã‚±ãƒƒãƒˆIDç”Ÿæˆ:',ticketId);const formElement=e.target;const formData={id:ticketId,type:'citizen',date:selectedDate,timeslot:selectedTimeslot,name:formElement.name.value.trim(),postal:formElement.postal.value.trim(),address:formElement.address.value.trim(),phone:formElement.phone.value.trim(),email:formElement.email.value.trim(),age:formElement.age.value,gender:formElement.gender.value,timestamp:new Date().toISOString(),status:'reserved',boardedAt:null,disembarkedAt:null};console.log('ğŸ“‹ äºˆç´„ãƒ‡ãƒ¼ã‚¿:',formData);const entries=JSON.parse(localStorage.getItem('citizenEntries')||'[]');entries.push(formData);localStorage.setItem('citizenEntries',JSON.stringify(entries));localStorage.setItem('lastUpdate',Date.now().toString());console.log('ğŸ’¾ localStorageä¿å­˜å®Œäº†:',entries.length,'ä»¶');console.log('ğŸ“¦ ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿:',entries);try{await fetch(GAS_URL,{method:'POST',mode:'no-cors',headers:{'Content-Type':'application/json'},body:JSON.stringify(formData)});console.log('âœ… ãƒ¡ãƒ¼ãƒ«é€ä¿¡å‡¦ç†å®Œäº†');}catch(emailError){console.log('âš ï¸ ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚¨ãƒ©ãƒ¼ï¼ˆç¶šè¡Œï¼‰:',emailError);}loadingOverlay.classList.remove('active');alert('âœ… äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸï¼\n\nã€äºˆç´„å†…å®¹ã€‘\nãŠåå‰: '+formData.name+'\næ—¥æ™‚: '+formData.date+' '+formData.timeslot+'\nãƒã‚±ãƒƒãƒˆID: '+formData.id+'\n\næ¬¡ã®ç”»é¢ã§QRã‚³ãƒ¼ãƒ‰ã‚’ã”ç¢ºèªãã ã•ã„ã€‚');window.location.href='ticket-citizen.html?id='+formData.id;}catch(error){console.error('âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ:',error);loadingOverlay.classList.remove('active');alert('âš ï¸ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');}}
        init();console.log('ğŸš€ ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ•ã‚©ãƒ¼ãƒ èµ·å‹•å®Œäº†');
    </script>
</body>
</html>
