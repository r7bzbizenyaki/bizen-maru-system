<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‚™å‰å¸‚ å¸‚æ°‘é™å®šå†…è¦§ä¼šãƒã‚±ãƒƒãƒˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 22px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-top: 15px;
        }

        .status-reserved {
            background: #fef3c7;
            color: #92400e;
        }

        .status-boarded {
            background: #d1fae5;
            color: #065f46;
        }

        .status-completed {
            background: #e0e7ff;
            color: #3730a3;
        }

        .qr-section {
            padding: 40px;
            text-align: center;
            background: #f8fafc;
        }

        .qr-code {
            background: white;
            padding: 20px;
            border-radius: 15px;
            display: inline-block;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .qr-code img {
            width: 250px;
            height: 250px;
            display: block;
        }

        .ticket-id {
            margin-top: 20px;
            font-size: 14px;
            color: #64748b;
            font-family: 'Monaco', 'Courier New', monospace;
        }

        .ticket-id strong {
            display: block;
            font-size: 16px;
            color: #334155;
            margin-top: 5px;
            word-break: break-all;
        }

        .info-section {
            padding: 30px;
        }

        .info-row {
            display: flex;
            padding: 15px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            width: 100px;
            font-size: 14px;
            color: #64748b;
            font-weight: 600;
        }

        .info-value {
            flex: 1;
            font-size: 16px;
            color: #1e293b;
        }

        .notice-section {
            background: #fef3c7;
            padding: 20px 30px;
            border-top: 2px solid #fbbf24;
        }

        .notice-section h3 {
            font-size: 14px;
            color: #92400e;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .notice-section ul {
            list-style: none;
            font-size: 13px;
            color: #78350f;
            line-height: 1.8;
        }

        .notice-section li:before {
            content: "â€¢ ";
            color: #f59e0b;
            font-weight: bold;
            margin-right: 5px;
        }

        .action-buttons {
            padding: 30px;
            display: flex;
            gap: 15px;
        }

        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #f8fafc;
        }

        .error-message {
            text-align: center;
            padding: 60px 30px;
            color: #dc2626;
        }

        .error-message h2 {
            font-size: 20px;
            margin-bottom: 10px;
        }

        .error-message p {
            font-size: 14px;
            color: #64748b;
            margin-bottom: 20px;
        }

        .error-message .btn {
            max-width: 200px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="container" id="ticketContainer"></div>

    <script>
        // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ãƒã‚±ãƒƒãƒˆIDã‚’å–å¾—
        const urlParams = new URLSearchParams(window.location.search);
        const ticketId = urlParams.get('id');

        console.log('ğŸ« URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰å–å¾—ã—ãŸãƒã‚±ãƒƒãƒˆID:', ticketId);

        if (!ticketId) {
            showError('ãƒã‚±ãƒƒãƒˆIDãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“', 'URLãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚äºˆç´„ç”»é¢ã‹ã‚‰ã‚„ã‚Šç›´ã—ã¦ãã ã•ã„ã€‚');
        } else {
            loadTicket(ticketId);
        }

        function loadTicket(id) {
            // LocalStorageã‹ã‚‰äºˆç´„ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            const entries = JSON.parse(localStorage.getItem('citizenEntries') || '[]');
            console.log('ğŸ’¾ LocalStorageã‹ã‚‰å–å¾—ã—ãŸäºˆç´„ãƒ‡ãƒ¼ã‚¿:', entries);
            
            // ãƒã‚±ãƒƒãƒˆIDã§æ¤œç´¢ï¼ˆå®Œå…¨ä¸€è‡´ï¼‰
            const ticket = entries.find(entry => entry.id === id);
            console.log('ğŸ” æ¤œç´¢çµæœ:', ticket ? 'âœ… è¦‹ã¤ã‹ã£ãŸ' : 'âŒ è¦‹ã¤ã‹ã‚‰ãªã„');
            
            if (!ticket) {
                console.error('âŒ ãƒã‚±ãƒƒãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚LocalStorageã®IDä¸€è¦§:');
                entries.forEach((e, i) => console.log(`  ${i + 1}. ${e.id}`));
                showError(
                    'äºˆç´„æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
                    `ãƒã‚±ãƒƒãƒˆID: ${id}\n\näºˆç´„ã—ãŸç«¯æœ«ã¨ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚`
                );
                return;
            }

            displayTicket(ticket);
        }

        function displayTicket(ticket) {
            const statusMap = {
                'reserved': { text: 'äºˆç´„æ¸ˆã¿', class: 'status-reserved' },
                'boarded': { text: 'ä¹—èˆ¹æ¸ˆã¿', class: 'status-boarded' },
                'completed': { text: 'ä¸‹èˆ¹å®Œäº†', class: 'status-completed' }
            };

            const dateMap = {
                '2026-02-27': '2æœˆ27æ—¥ (é‡‘)',
                '2026-03-27': '3æœˆ27æ—¥ (é‡‘)',
                '2026-03-28': '3æœˆ28æ—¥ (åœŸ)'
            };

            const status = statusMap[ticket.status] || statusMap['reserved'];
            const dateText = dateMap[ticket.date] || ticket.date;

            // QRã‚³ãƒ¼ãƒ‰URLã‚’ç”Ÿæˆï¼ˆãƒã‚±ãƒƒãƒˆIDã‚’ãã®ã¾ã¾ä½¿ç”¨ï¼‰
            const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent(ticket.id)}`;

            console.log('ğŸ¨ è¡¨ç¤ºã™ã‚‹ãƒã‚±ãƒƒãƒˆæƒ…å ±:');
            console.log('  ID:', ticket.id);
            console.log('  QR URL:', qrCodeUrl);
            console.log('  ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:', status.text);

            const html = `
                <div class="header">
                    <h1>ğŸš¢ å‚™å‰å¸‚ å¸‚æ°‘é™å®šå†…è¦§ä¼š</h1>
                    <p>é›»å­ãƒã‚±ãƒƒãƒˆ</p>
                    <div class="status-badge ${status.class}">${status.text}</div>
                </div>

                <div class="qr-section">
                    <div class="qr-code">
                        <img src="${qrCodeUrl}" alt="QRã‚³ãƒ¼ãƒ‰">
                    </div>
                    <div class="ticket-id">
                        ãƒã‚±ãƒƒãƒˆID<br>
                        <strong>${ticket.id}</strong>
                    </div>
                </div>

                <div class="info-section">
                    <div class="info-row">
                        <div class="info-label">ãŠåå‰</div>
                        <div class="info-value">${ticket.name} æ§˜</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">æ—¥æ™‚</div>
                        <div class="info-value">${dateText}<br>${ticket.timeslot}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">é›»è©±ç•ªå·</div>
                        <div class="info-value">${ticket.phone}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">ãƒ¡ãƒ¼ãƒ«</div>
                        <div class="info-value">${ticket.email}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">ä½æ‰€</div>
                        <div class="info-value">${ticket.address}</div>
                    </div>
                </div>

                <div class="notice-section">
                    <h3>âš ï¸ ã”æ¥å ´æ™‚ã®æ³¨æ„äº‹é …</h3>
                    <ul>
                        <li>å½“æ—¥ã¯ã“ã®QRã‚³ãƒ¼ãƒ‰ã‚’ã”æç¤ºãã ã•ã„</li>
                        <li>äºˆç´„æ™‚é–“ã®10åˆ†å‰ã¾ã§ã«ãŠè¶Šã—ãã ã•ã„</li>
                        <li>æœ¬äººç¢ºèªã®ãŸã‚èº«åˆ†è¨¼æ˜æ›¸ã‚’ã”æŒå‚ãã ã•ã„</li>
                        <li>å¤©å€™ã«ã‚ˆã‚Šä¸­æ­¢ã®å ´åˆãŒã‚ã‚Šã¾ã™</li>
                    </ul>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="downloadQR()">QRã‚³ãƒ¼ãƒ‰ä¿å­˜</button>
                    <button class="btn btn-primary" onclick="window.print()">å°åˆ·ã™ã‚‹</button>
                </div>
            `;

            document.getElementById('ticketContainer').innerHTML = html;
        }

        function showError(title, message) {
            const html = `
                <div class="error-message">
                    <h2>âŒ ${title}</h2>
                    <p>${message}</p>
                    <button class="btn btn-primary" onclick="location.href='entry-form-citizen.html'">
                        äºˆç´„ç”»é¢ã«æˆ»ã‚‹
                    </button>
                </div>
            `;
            document.getElementById('ticketContainer').innerHTML = html;
        }

        function downloadQR() {
            const qrImg = document.querySelector('.qr-code img');
            if (!qrImg) return;

            const link = document.createElement('a');
            link.href = qrImg.src;
            link.download = `bizen-maru-ticket-${ticketId}.png`;
            link.click();
        }

        // LocalStorageã®å¤‰æ›´ã‚’ç›£è¦–
        window.addEventListener('storage', (e) => {
            if (e.key === 'citizenEntries') {
                console.log('ğŸ“¡ LocalStorageãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚ãƒªãƒ­ãƒ¼ãƒ‰ä¸­...');
                location.reload();
            }
        });
    </script>
</body>
</html>
