<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‚™å‰ä¸¸ å¸‚æ°‘é™å®šå†…è¦§ä¼šãƒã‚±ãƒƒãƒˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .ticket-container {
            max-width: 500px;
            width: 100%;
            background: white;
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .ticket-header {
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 2px dashed #ccc;
        }

        .badge {
            display: inline-block;
            background: #27ae60;
            color: white;
            padding: 8px 20px;
            border-radius: 24px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .ticket-header h1 {
            color: #c41e3a;
            font-size: 24px;
            margin-bottom: 8px;
        }

        .ticket-header p {
            color: #666;
            font-size: 14px;
        }

        .qr-section {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    border-radius: 16px;
    padding: 32px;
    margin: 0 auto 24px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
}

.qr-code {
    background: white;
    padding: 20px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    width: fit-content;
    max-width: 100%;
}

.qr-code img {
    display: block;
    width: 200px;
    height: 200px;
    margin: 0 auto;
}
        .qr-text {
            margin-top: 16px;
            font-size: 14px;
            color: #333;
            font-weight: 600;
            text-align: center;
        }

        .ticket-info {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            text-align: left;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: #666;
            font-size: 14px;
            font-weight: 600;
        }

        .info-value {
            color: #333;
            font-size: 14px;
            font-weight: 600;
            text-align: right;
        }

        .date-highlight {
            background: #2a5298;
            color: white;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .date-highlight .date {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .date-highlight .time {
            font-size: 16px;
            opacity: 0.9;
        }

        .ticket-id {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: 600;
            color: #856404;
            word-break: break-all;
        }

        .notice-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            text-align: left;
        }

        .notice-box h3 {
            color: #856404;
            font-size: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .notice-box ul {
            list-style: none;
            padding: 0;
        }

        .notice-box li {
            color: #856404;
            font-size: 13px;
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
        }

        .notice-box li::before {
            content: 'â€¢';
            position: absolute;
            left: 0;
            font-weight: bold;
        }

        .action-buttons {
            display: grid;
            gap: 12px;
        }

        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #2a5298;
            color: white;
        }

        .btn-primary:hover {
            background: #1e3c72;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(42, 82, 152, 0.3);
        }

        .btn-secondary {
            background: #27ae60;
            color: white;
        }

        .btn-secondary:hover {
            background: #229954;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }

        .error-message {
            background: #ffebee;
            border: 2px solid #c62828;
            border-radius: 12px;
            padding: 20px;
            color: #c62828;
            margin-bottom: 20px;
        }

        .error-message h2 {
            font-size: 20px;
            margin-bottom: 12px;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .status-reserved {
            background: #e3f2fd;
            color: #1976d2;
        }

        .status-boarded {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-completed {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        @media (max-width: 600px) {
            .ticket-container {
                padding: 24px;
            }

            .qr-code img {
                width: 180px;
                height: 180px;
            }
        }
    </style>
</head>
<body>
    <div class="ticket-container">
        <div class="ticket-header">
            <div class="badge">ğŸ›ï¸ å¸‚æ°‘é™å®š</div>
            <h1>ğŸš¢ å‚™å‰ä¸¸ å†…è¦§ä¼š</h1>
            <p>ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚±ãƒƒãƒˆ</p>
        </div>

        <div id="ticketContent">
            <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
        </div>
    </div>

    <script>
        // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ãƒã‚±ãƒƒãƒˆIDã‚’å–å¾—
        const urlParams = new URLSearchParams(window.location.search);
        const ticketId = urlParams.get('id');

        console.log('ğŸ« ãƒã‚±ãƒƒãƒˆID:', ticketId);

        // æ—¥ä»˜ãƒãƒƒãƒ”ãƒ³ã‚°
        const dateMap = {
            '2026-02-27': { display: '2æœˆ27æ—¥', day: 'é‡‘æ›œæ—¥' },
            '2026-03-27': { display: '3æœˆ27æ—¥', day: 'é‡‘æ›œæ—¥' },
            '2026-03-28': { display: '3æœˆ28æ—¥', day: 'åœŸæ›œæ—¥' }
        };

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒãƒ”ãƒ³ã‚°
        const statusMap = {
            'reserved': { text: 'äºˆç´„æ¸ˆã¿', class: 'status-reserved' },
            'boarded': { text: 'ä¹—èˆ¹ä¸­', class: 'status-boarded' },
            'completed': { text: 'ä¸‹èˆ¹æ¸ˆã¿', class: 'status-completed' }
        };

        // ãƒã‚±ãƒƒãƒˆè¡¨ç¤º
        function displayTicket() {
            const container = document.getElementById('ticketContent');

            if (!ticketId) {
                container.innerHTML = `
                    <div class="error-message">
                        <h2>âŒ ã‚¨ãƒ©ãƒ¼</h2>
                        <p>ãƒã‚±ãƒƒãƒˆIDãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
                        <p style="margin-top: 12px;">ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ãŠç”³ã—è¾¼ã¿ãã ã•ã„ã€‚</p>
                    </div>
                    <div class="action-buttons">
                        <a href="index-citizen.html" class="btn btn-primary">ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ•ã‚©ãƒ¼ãƒ ã¸</a>
                    </div>
                `;
                return;
            }

            // localStorageã‹ã‚‰äºˆç´„ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            const entries = JSON.parse(localStorage.getItem('citizenEntries') || '[]');
            const ticket = entries.find(e => e.id === ticketId);

            console.log('ğŸ” ãƒã‚±ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿:', ticket);

            if (!ticket) {
                container.innerHTML = `
                    <div class="error-message">
                        <h2>âŒ ãƒã‚±ãƒƒãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</h2>
                        <p>æŒ‡å®šã•ã‚ŒãŸãƒã‚±ãƒƒãƒˆIDã€Œ${ticketId}ã€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
                        <p style="margin-top: 12px;">ã‚‚ã†ä¸€åº¦ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ãŠç”³ã—è¾¼ã¿ãã ã•ã„ã€‚</p>
                    </div>
                    <div class="action-buttons">
                        <a href="index-citizen.html" class="btn btn-primary">ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ•ã‚©ãƒ¼ãƒ ã¸</a>
                    </div>
                `;
                return;
            }

            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æƒ…å ±
            const status = statusMap[ticket.status] || statusMap['reserved'];
            
            // æ—¥ä»˜æƒ…å ±
            const dateInfo = dateMap[ticket.date] || { display: ticket.date, day: '' };

            // QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
            const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(ticketId)}`;

            container.innerHTML = `
                <div class="status-badge ${status.class}">${status.text}</div>

                <div class="date-highlight">
                    <div class="date">${dateInfo.display}ï¼ˆ${dateInfo.day}ï¼‰</div>
                    <div class="time">${ticket.timeslot}ã€œ å…¥å ´äºˆå®š</div>
                </div>

                <div class="qr-section">
                    <div class="qr-code">
                        <img src="${qrCodeUrl}" alt="QRã‚³ãƒ¼ãƒ‰" id="qrCodeImage">
                    </div>
                    <div class="qr-text">å½“æ—¥ã“ã®QRã‚³ãƒ¼ãƒ‰ã‚’ã”æç¤ºãã ã•ã„</div>
                </div>

                <div class="ticket-id">
                    ãƒã‚±ãƒƒãƒˆID: ${ticketId}
                </div>

                <div class="ticket-info">
                    <div class="info-row">
                        <span class="info-label">ãŠåå‰</span>
                        <span class="info-value">${ticket.name}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">é›»è©±ç•ªå·</span>
                        <span class="info-value">${ticket.phone}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</span>
                        <span class="info-value">${ticket.email}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ä½æ‰€</span>
                        <span class="info-value">${ticket.address}</span>
                    </div>
                </div>

                <div class="notice-box">
                    <h3>âš ï¸ å½“æ—¥ã®ã”æ³¨æ„</h3>
                    <ul>
                        <li>äºˆç´„æ™‚é–“ã®5åˆ†å‰ã¾ã§ã«å—ä»˜ã«ãŠè¶Šã—ãã ã•ã„</li>
                        <li>èˆ¹å†…ã§ã®é£²é£Ÿã¯ç¦æ­¢ã§ã™</li>
                        <li>ç”³è¾¼çŠ¶æ³ã«ã‚ˆã‚Šæ™‚é–“ãŒå‰å¾Œã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™</li>
                        <li>ã‚¹ã‚¿ãƒƒãƒ•ã®æŒ‡ç¤ºã«å¾“ã£ã¦ãã ã•ã„</li>
                    </ul>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="downloadQR()">ğŸ“¥ QRã‚³ãƒ¼ãƒ‰ã‚’ä¿å­˜</button>
                    <button class="btn btn-secondary" onclick="window.print()">ğŸ–¨ï¸ å°åˆ·ã™ã‚‹</button>
                </div>
            `;

            console.log('âœ… ãƒã‚±ãƒƒãƒˆè¡¨ç¤ºå®Œäº†');
        }

        // QRã‚³ãƒ¼ãƒ‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        function downloadQR() {
            const qrImage = document.getElementById('qrCodeImage');
            const link = document.createElement('a');
            link.download = `å‚™å‰ä¸¸ãƒã‚±ãƒƒãƒˆ_${ticketId}.png`;
            link.href = qrImage.src;
            link.click();
            console.log('ğŸ“¥ QRã‚³ãƒ¼ãƒ‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰');
        }

        // åˆæœŸåŒ–
        displayTicket();

        // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ç›£è¦–
        window.addEventListener('storage', function(e) {
            if (e.key === 'citizenEntries' || e.key === 'lastUpdate') {
                console.log('ğŸ”„ ãƒ‡ãƒ¼ã‚¿æ›´æ–°æ¤œå‡º - ãƒã‚±ãƒƒãƒˆå†è¡¨ç¤º');
                displayTicket();
            }
        });

        console.log('ğŸ« ãƒã‚±ãƒƒãƒˆç”»é¢åˆæœŸåŒ–å®Œäº†');
    </script>
</body>
</html>
