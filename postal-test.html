<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éƒµä¾¿ç•ªå·æ¤œç´¢ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        input:focus {
            outline: none;
            border-color: #4CAF50;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
        }
        button:hover {
            background: #45a049;
        }
        #log {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .info { color: #2196F3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” éƒµä¾¿ç•ªå·æ¤œç´¢ãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="form-group">
            <label for="postal">éƒµä¾¿ç•ªå·ï¼ˆ7æ¡ï¼‰</label>
            <input type="text" id="postal" placeholder="ä¾‹: 1000001">
        </div>
        
        <div class="form-group">
            <label for="address">ä½æ‰€ï¼ˆè‡ªå‹•å…¥åŠ›ï¼‰</label>
            <input type="text" id="address" placeholder="ä½æ‰€ãŒè‡ªå‹•å…¥åŠ›ã•ã‚Œã¾ã™" readonly>
        </div>
        
        <button onclick="searchPostal()">ğŸ” æ¤œç´¢</button>
        
        <div id="log"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = 'log-entry ' + type;
            entry.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        async function searchPostal() {
            log('ğŸ”¥ searchPostal() é–‹å§‹', 'info');
            
            const postalInput = document.getElementById('postal');
            const addressInput = document.getElementById('address');
            
            // æ•°å­—ä»¥å¤–ã‚’å‰Šé™¤
            const postal = postalInput.value.replace(/[^0-9]/g, '');
            
            log('ğŸ“® éƒµä¾¿ç•ªå·: ' + postal + ' (' + postal.length + 'æ¡)', 'info');
            
            if (postal.length !== 7) {
                log('âš ï¸ éƒµä¾¿ç•ªå·ã¯7æ¡ã§å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                alert('éƒµä¾¿ç•ªå·ã¯7æ¡ã§å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            addressInput.value = 'æ¤œç´¢ä¸­...';
            
            try {
                const url = 'https://zipcloud.ibsnet.co.jp/api/search?zipcode=' + postal;
                log('ğŸŒ APIå‘¼ã³å‡ºã—: ' + url, 'info');
                
                const response = await fetch(url);
                const data = await response.json();
                
                log('ğŸ“¦ APIå¿œç­”: ' + JSON.stringify(data), 'info');
                
                if (data.status === 200 && data.results && data.results.length > 0) {
                    const result = data.results[0];
                    const address = result.address1 + result.address2 + result.address3;
                    addressInput.value = address;
                    log('âœ… ä½æ‰€å–å¾—æˆåŠŸ: ' + address, 'success');
                } else {
                    addressInput.value = '';
                    log('âŒ è©²å½“ã™ã‚‹ä½æ‰€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ', 'error');
                    alert('è©²å½“ã™ã‚‹ä½æ‰€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
                }
            } catch (error) {
                addressInput.value = '';
                log('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
                alert('æ¤œç´¢ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        // è‡ªå‹•æ¤œç´¢ï¼ˆ7æ¡å…¥åŠ›æ™‚ï¼‰
        document.getElementById('postal').addEventListener('input', function(e) {
            const postal = e.target.value.replace(/[^0-9]/g, '');
            log('ğŸ“ å…¥åŠ›: ' + postal + ' (' + postal.length + 'æ¡)', 'info');
            
            if (postal.length === 7) {
                log('âœ… 7æ¡å…¥åŠ›å®Œäº† â†’ è‡ªå‹•æ¤œç´¢é–‹å§‹', 'success');
                searchPostal();
            }
        });

        log('âœ… ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†', 'success');
    </script>
</body>
</html>
